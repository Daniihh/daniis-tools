"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})},__generator=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j},__rest=this&&this.__rest||function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c};exports.__esModule=!0;var fs=require("fs"),path=require("path"),gulp=require("gulp"),child=require("child_process"),config="gulpconfig.json",pathRegex=/((?:[\/\\]?[a-zA-Z.*]+)*)/,isPath=/\/|\\/g;function isTask(a){var b=Object.getOwnPropertyNames(a);return[["source",String],["actions",Array]].every(function(c){return b.some(function(b){return c[0]==b&&Object.getPrototypeOf(a[b]).constructor==c[1]})})}function aquire(a){try{return Promise.resolve(require(a))}catch(b){return new Promise(function(b,c){child.exec("npm i "+a,function(d){return d?c(d):b(require(a))})})}}function executeTask(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,f,g,h=this;return __generator(this,function(i){switch(i.label){case 0:if(!pathRegex.test(a.source))throw new TypeError("Source is not a valid path.");return b=function(a){return __awaiter(h,void 0,void 0,function(){var b,c,d,e=a.action,f=__rest(a,["action"]);return __generator(this,function(a){switch(a.label){case 0:return b=e.split("."),[4,aquire(b.shift())];case 1:return c=a.sent(),d=b.reduce(function(a,b){return a[b]},c),[2,__assign({action:d},f)];}})})},[4,Promise.all(a.actions.map(b))];case 1:for(c=i.sent(),d=gulp.src(a.source),(e=0,f=c);e<f.length;e++)if(g=f[e],d=d.pipe(g.action.apply(g,g.arguments||[])),g.destination){if(!pathRegex.test(g.destination))throw new TypeError("Destination is not a valid path.");d=d.pipe(gulp.dest(g.destination))}return[2];}})})}function main(a){switch(a[0]){case"run":var b=void 0,c=void 0;a[1]&&isPath.test(a[1])?c=a[1]:(a[2]&&isPath.test(a[2])&&(c=a[2]),b=a[1]),c=c?path.join(__dirname,c):__dirname,c=!c||c.endsWith(config)?c:path.join(c,config);var d=void 0,e=[function(){return console.log("Task complete.")},console.error];try{d=JSON.parse(fs.readFileSync(c).toString())}catch(a){console.error(a)}var f;if(isTask(d))f=executeTask(d);else{var g=b?d[b]:d["default"];if(!g)throw new Error("Invalid task.");f=executeTask(g)}f.then.apply(f,e);break;case void 0:break;default:}}main(process.argv.splice(2));